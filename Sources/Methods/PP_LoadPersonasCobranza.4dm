//%attributes = {}
  //PP_LoadPersonasCobranza

ACT_relacionaCtasyApdos (2)
LOAD RECORD:C52([Personas:7])
ORDER BY:C49([ACT_CuentasCorrientes:175];[Alumnos:2]nivel_numero:29;>;[Alumnos:2]curso:20;>)
FIRST RECORD:C50([ACT_CuentasCorrientes:175])
ARRAY REAL:C219(arACT_CCFacturado;0)
ARRAY REAL:C219(arACT_CCVencido;0)
ARRAY REAL:C219(arACT_CCSaldo;0)
ARRAY DATE:C224(adACT_CCFechas;0)
ARRAY REAL:C219(arACT_CCProyectadoEjercicio;0)
ARRAY REAL:C219(arACT_CCPagado;0)
ARRAY TEXT:C222(atACT_CCAlumno;0)
ARRAY TEXT:C222(atACT_CCCurso;0)
READ ONLY:C145([Alumnos:2])
READ ONLY:C145([ACT_Apoderados_de_Cuenta:107])
READ ONLY:C145([ACT_Pagos:172])
$index:=Records in selection:C76([ACT_CuentasCorrientes:175])
ARRAY TEXT:C222(atACT_CCAlumno;$index)
ARRAY TEXT:C222(atACT_CCCurso;$index)
ARRAY REAL:C219(arACT_CCVencido;$index)
ARRAY LONGINT:C221($al_recNum;0)
LONGINT ARRAY FROM SELECTION:C647([ACT_CuentasCorrientes:175];$al_recNum)
For ($o;1;Size of array:C274($al_recNum))
	REDUCE SELECTION:C351([ACT_CuentasCorrientes:175];0)
	KRL_GotoRecord (->[ACT_CuentasCorrientes:175];$al_recNum{$o})
	  //For ($o;1;Records in selection([ACT_CuentasCorrientes]))
	AT_Insert (0;1;->arACT_CCFacturado;->arACT_CCSaldo;->arACT_CCProyectadoEjercicio;->arACT_CCPagado)
	ARRAY INTEGER:C220($aExApdode;Size of array:C274(arACT_CCVencido))
	QUERY:C277([Alumnos:2];[Alumnos:2]numero:1=[ACT_CuentasCorrientes:175]ID_Alumno:3)
	atACT_CCAlumno{$o}:=[Alumnos:2]apellidos_y_nombres:40
	atACT_CCCurso{$o}:=[Alumnos:2]curso:20
	QUERY:C277([ACT_Cargos:173];[ACT_Cargos:173]ID_CuentaCorriente:2=[ACT_CuentasCorrientes:175]ID:1;*)
	QUERY:C277([ACT_Cargos:173]; & ;[ACT_Cargos:173]ID_Apoderado:18=[Personas:7]No:1;*)
	QUERY:C277([ACT_Cargos:173]; & ;[ACT_Cargos:173]EsRelativo:10=False:C215)
	CREATE SET:C116([ACT_Cargos:173];"todos")
	QUERY SELECTION:C341([ACT_Cargos:173];[ACT_Cargos:173]FechaEmision:22=!00-00-00!)
	  //arACT_CCProyectadoEjercicio{Size of array(arACT_CCProyectadoEjercicio)}:=Sum([ACT_Cargos]Monto_Neto)+Sum([ACT_Cargos]Intereses)
	arACT_CCProyectadoEjercicio{Size of array:C274(arACT_CCProyectadoEjercicio)}:=ACTcar_CalculaMontos ("redondeadoFromCurrentRecordsMPago";->[ACT_Cargos:173]Monto_Neto:5;->[ACT_Cargos:173]Monto_Neto:5;Current date:C33(*))
	USE SET:C118("todos")
	QUERY SELECTION:C341([ACT_Cargos:173];[ACT_Cargos:173]FechaEmision:22#!00-00-00!)
	  //arACT_CCFacturado{Size of array(arACT_CCFacturado)}:=Sum([ACT_Cargos]Monto_Neto)+Sum([ACT_Cargos]Intereses)
	arACT_CCFacturado{Size of array:C274(arACT_CCFacturado)}:=ACTcar_CalculaMontos ("redondeadoFromCurrentRecordsMPago";->[ACT_Cargos:173]Monto_Neto:5;->[ACT_Cargos:173]Monto_Neto:5;Current date:C33(*))
	USE SET:C118("todos")
	QUERY SELECTION:C341([ACT_Cargos:173];[ACT_Cargos:173]FechaEmision:22#!00-00-00!)
	arACT_CCProyectadoEjercicio{Size of array:C274(arACT_CCProyectadoEjercicio)}:=arACT_CCProyectadoEjercicio{Size of array:C274(arACT_CCProyectadoEjercicio)}+arACT_CCFacturado{Size of array:C274(arACT_CCFacturado)}
	QUERY:C277([ACT_Pagos:172];[ACT_Pagos:172]ID_CtaCte:21=[ACT_CuentasCorrientes:175]ID:1;*)
	QUERY:C277([ACT_Pagos:172]; & ;[ACT_Pagos:172]Saldo:15>0)
	arACT_CCPagado{Size of array:C274(arACT_CCPagado)}:=Sum:C1([ACT_Cargos:173]MontosPagadosMPago:52)+Sum:C1([ACT_Pagos:172]Saldo:15)
	arACT_CCSaldo{Size of array:C274(arACT_CCSaldo)}:=ACTcar_CalculaMontos ("redondeadoFromCurrentRecordsMPago";->[ACT_Cargos:173]Saldo:23;->[ACT_Cargos:173]Saldo:23;Current date:C33(*))+Sum:C1([ACT_Pagos:172]Saldo:15)
	USE SET:C118("todos")
	QUERY SELECTION:C341([ACT_Cargos:173];[ACT_Cargos:173]FechaEmision:22#!00-00-00!)
	QUERY SELECTION:C341([ACT_Cargos:173];[ACT_Cargos:173]Fecha_de_Vencimiento:7<Current date:C33(*))
	arACT_CCVencido{$o}:=Abs:C99(ACTcar_CalculaMontos ("redondeadoFromCurrentRecordsMPago";->[ACT_Cargos:173]Saldo:23;->[ACT_Cargos:173]Saldo:23;Current date:C33(*)))
	
	QUERY:C277([ACT_Apoderados_de_Cuenta:107];[ACT_Apoderados_de_Cuenta:107]ID_CtaCte:2=[ACT_CuentasCorrientes:175]ID:1;*)
	QUERY:C277([ACT_Apoderados_de_Cuenta:107]; & ;[ACT_Apoderados_de_Cuenta:107]ID_Apoderado:1=[Personas:7]No:1)
End for 
CLEAR SET:C117("todos")
READ ONLY:C145([ACT_Pagos:172])
QUERY:C277([ACT_Pagos:172];[ACT_Pagos:172]ID_Apoderado:3=[Personas:7]No:1;*)
QUERY:C277([ACT_Pagos:172]; & ;[ACT_Pagos:172]ID_CtaCte:21=0;*)
QUERY:C277([ACT_Pagos:172]; & ;[ACT_Pagos:172]Saldo:15>0)
$pagos:=Sum:C1([ACT_Pagos:172]Saldo:15)

vrACT_Deuda_Vencida:=AT_GetSumArray (->arACT_CCVencido)
vrACT_Total_Saldo:=AT_GetSumArray (->arACT_CCSaldo)+$pagos