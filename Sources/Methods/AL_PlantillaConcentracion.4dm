//%attributes = {}
  //AL_PlantillaConcentracion

vAsigPC_1:=""
vAsigPC_2:=""
vAsigPC_3:=""
vAsigPC_4:=""
vAsigPC_5:=""
vAsigPC_6:=""
vAsigPC_7:=""
vAsigPC_8:=""
vAsigPC_9:=""
vAsigPC_10:=""
vAsigPC_11:=""
vAsigPC_12:=""
vAsigPC_13:=""
vAsigPC_14:=""
vAsigPC_15:=""
vAsigPC_16:=""
vAsigPC_17:=""
vAsigPC_18:=""
vAsigPC_19:=""
vAsigPC_20:=""

vAsigPE_1:=""
vAsigPE_2:=""
vAsigPE_3:=""
vAsigPE_4:=""
vAsigPE_5:=""
vAsigPE_6:=""
vAsigPE_7:=""
vAsigPE_8:=""
vAsigPE_9:=""
vAsigPE_10:=""
vAsigPE_11:=""
vAsigPE_12:=""
vAsigPE_13:=""
vAsigPE_14:=""
vAsigPE_15:=""
vAsigPE_16:=""
vAsigPE_17:=""
vAsigPE_18:=""
vAsigPE_19:=""
vAsigPE_20:=""
vAsigPE_21:=""
vAsigPE_22:=""
vAsigPE_23:=""
vAsigPE_24:=""

vCALPC1_1:=""
vCALPC1_2:=""
vCALPC1_3:=""
vCALPC1_4:=""
vCALPC1_5:=""
vCALPC1_6:=""
vCALPC1_7:=""
vCALPC1_8:=""
vCALPC1_9:=""
vCALPC1_10:=""
vCALPC1_11:=""
vCALPC1_12:=""
vCALPC1_13:=""
vCALPC1_14:=""
vCALPC1_15:=""
vCALPC1_16:=""
vCALPC1_17:=""
vCALPC1_18:=""
vCALPC1_19:=""
vCALPC1_20:=""
vCALPC2_1:=""
vCALPC2_2:=""
vCALPC2_3:=""
vCALPC2_4:=""
vCALPC2_5:=""
vCALPC2_6:=""
vCALPC2_7:=""
vCALPC2_8:=""
vCALPC2_9:=""
vCALPC2_10:=""
vCALPC2_11:=""
vCALPC2_12:=""
vCALPC2_13:=""
vCALPC2_14:=""
vCALPC2_15:=""
vCALPC2_16:=""
vCALPC2_17:=""
vCALPC2_18:=""
vCALPC2_19:=""
vCALPC2_20:=""
vCALPC3_1:=""
vCALPC3_2:=""
vCALPC3_3:=""
vCALPC3_4:=""
vCALPC3_5:=""
vCALPC3_6:=""
vCALPC3_7:=""
vCALPC3_8:=""
vCALPC3_9:=""
vCALPC3_10:=""
vCALPC3_11:=""
vCALPC3_12:=""
vCALPC3_13:=""
vCALPC3_14:=""
vCALPC3_15:=""
vCALPC3_16:=""
vCALPC3_17:=""
vCALPC3_18:=""
vCALPC3_19:=""
vCALPC3_20:=""
vCALPC4_1:=""
vCALPC4_2:=""
vCALPC4_3:=""
vCALPC4_4:=""
vCALPC4_5:=""
vCALPC4_6:=""
vCALPC4_7:=""
vCALPC4_8:=""
vCALPC4_9:=""
vCALPC4_10:=""
vCALPC4_11:=""
vCALPC4_12:=""
vCALPC4_13:=""
vCALPC4_14:=""
vCALPC4_15:=""
vCALPC4_16:=""
vCALPC4_17:=""
vCALPC4_18:=""
vCALPC4_19:=""
vCALPC4_20:=""
vCALPE1_1:=""
vCALPE1_2:=""
vCALPE1_3:=""
vCALPE1_4:=""
vCALPE1_5:=""
vCALPE1_6:=""
vCALPE1_7:=""
vCALPE1_8:=""
vCALPE1_9:=""
vCALPE1_10:=""
vCALPE1_11:=""
vCALPE1_12:=""
vCALPE1_13:=""
vCALPE1_14:=""
vCALPE1_15:=""
vCALPE1_16:=""
vCALPE1_17:=""
vCALPE1_18:=""
vCALPE1_19:=""
vCALPE1_20:=""
vCALPE1_21:=""
vCALPE1_22:=""
vCALPE1_23:=""
vCALPE1_24:=""

vCALPE2_1:=""
vCALPE2_2:=""
vCALPE2_3:=""
vCALPE2_4:=""
vCALPE2_5:=""
vCALPE2_6:=""
vCALPE2_7:=""
vCALPE2_8:=""
vCALPE2_9:=""
vCALPE2_10:=""
vCALPE2_11:=""
vCALPE2_12:=""
vCALPE2_13:=""
vCALPE2_14:=""
vCALPE2_15:=""
vCALPE2_16:=""
vCALPE2_17:=""
vCALPE2_18:=""
vCALPE2_19:=""
vCALPE2_20:=""
vCALPE2_21:=""
vCALPE2_22:=""
vCALPE2_23:=""
vCALPE2_24:=""

vCALPE3_1:=""
vCALPE3_2:=""
vCALPE3_3:=""
vCALPE3_4:=""
vCALPE3_5:=""
vCALPE3_6:=""
vCALPE3_7:=""
vCALPE3_8:=""
vCALPE3_9:=""
vCALPE3_10:=""
vCALPE3_11:=""
vCALPE3_12:=""
vCALPE3_13:=""
vCALPE3_14:=""
vCALPE3_15:=""
vCALPE3_16:=""
vCALPE3_17:=""
vCALPE3_18:=""
vCALPE3_19:=""
vCALPE3_20:=""
vCALPE3_21:=""
vCALPE3_22:=""
vCALPE3_23:=""
vCALPE3_24:=""

vCALPE4_1:=""
vCALPE4_2:=""
vCALPE4_3:=""
vCALPE4_4:=""
vCALPE4_5:=""
vCALPE4_6:=""
vCALPE4_7:=""
vCALPE4_8:=""
vCALPE4_9:=""
vCALPE4_10:=""
vCALPE4_11:=""
vCALPE4_12:=""
vCALPE4_13:=""
vCALPE4_14:=""
vCALPE4_15:=""
vCALPE4_16:=""
vCALPE4_17:=""
vCALPE4_18:=""
vCALPE4_19:=""
vCALPE4_20:=""
vCALPE4_21:=""
vCALPE4_22:=""
vCALPE4_23:=""
vCALPE4_24:=""

  //ARRAY TEXT(aPCAsgName;0)
  //ARRAY INTEGER(aPCAsgPos;0)
  //ARRAY TEXT(aPEAsgName;0)
  //ARRAY INTEGER(aPEAsgPos;0)
_O_C_INTEGER:C282($cantidadElectivas)
ARRAY TEXT:C222($aAsignaturas_Alumno_PC;0)
ARRAY TEXT:C222($aAsignaturas_Alumno_PE;0)

$recNum:=Record number:C243([Alumnos:2])

  //años en los que el alumno fue promovido


QUERY:C277([Alumnos_SintesisAnual:210];[Alumnos_SintesisAnual:210]ID_Alumno:4=[Alumnos:2]numero:1;*)
QUERY:C277([Alumnos_SintesisAnual:210]; | [Alumnos_SintesisAnual:210]ID_Alumno:4;=;-[Alumnos:2]numero:1)
QUERY SELECTION:C341([Alumnos_SintesisAnual:210]; & [Alumnos_SintesisAnual:210]NumeroNivel:6>=9;*)
QUERY SELECTION:C341([Alumnos_SintesisAnual:210]; & [Alumnos_SintesisAnual:210]NumeroNivel:6<=12;*)
QUERY SELECTION:C341([Alumnos_SintesisAnual:210]; & [Alumnos_SintesisAnual:210]SituacionFinal:8="P";*)
QUERY SELECTION:C341([Alumnos_SintesisAnual:210]; & [Alumnos_SintesisAnual:210]Año:2<<>gYear)
SELECTION TO ARRAY:C260([Alumnos_SintesisAnual:210]Año:2;$aAños)
If ([Alumnos:2]nivel_numero:29<12)
	APPEND TO ARRAY:C911($aAños;<>gYear)
End if 



  //ASIGNATURAS OBLIGATORIAS (PLAN COMUN)
SET AUTOMATIC RELATIONS:C310(True:C214;False:C215)
QUERY:C277([Alumnos_Calificaciones:208];[Alumnos_Calificaciones:208]ID_Alumno:6;=;[Alumnos:2]numero:1;*)
QUERY:C277([Alumnos_Calificaciones:208]; | [Alumnos_Calificaciones:208]ID_Alumno:6;=;-[Alumnos:2]numero:1)
QRY_QueryWithArray (->[Alumnos_Calificaciones:208]Año:3;->$aAños;True:C214)
QUERY SELECTION:C341([Alumnos_Calificaciones:208];[Asignaturas_Historico:84]Electiva:10=False:C215;*)
QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas_Historico:84]Incluida_En_Actas:7=True:C214;*)
QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas_Historico:84]Promediable:6=True:C214;*)
QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas_Historico:84]Optativa:24=False:C215;*)
QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas_Historico:84]Asignatura:2#"Religión";*)
QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Alumnos_Calificaciones:208]EvaluacionFinalOficial_Literal:36#"")
ORDER BY:C49([Alumnos_Calificaciones:208];[Asignaturas_Historico:84]Asignatura:2;>)
SELECTION TO ARRAY:C260([Alumnos_Calificaciones:208]EvaluacionFinalOficial_Literal:36;$aGrades;[Asignaturas_Historico:84]Asignatura:2;$aAsig;[Asignaturas_Historico:84]Order:11;$aOrden;[Asignaturas_Historico:84]OrdenGeneral:42;$atOrdenGeneral)
SET AUTOMATIC RELATIONS:C310(False:C215;False:C215)

For ($i;Size of array:C274($aAsig);1;-1)
	If ($aAsig{$i}=$aAsig{$i-1})
		AT_Delete ($i;1;->$aGrades;->$aAsig;->$aOrden)
	End if 
End for 
AT_MultiLevelSort (">>";->$aOrden;->$aAsig;->$aGrades)
For ($i;1;Size of array:C274($aAsig))
	APPEND TO ARRAY:C911($aAsignaturas_Alumno_PC;$aAsig{$i})
End for 


  //ASIGNATURAS obligatorias , año actual
GOTO RECORD:C242([Alumnos:2];$recNum)
If ([Alumnos:2]nivel_numero:29<=12)
	SET AUTOMATIC RELATIONS:C310(True:C214;False:C215)
	EV2_RegistrosDelAlumno ([Alumnos:2]numero:1)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208];[Asignaturas:18]Electiva:11=False:C215;*)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas:18]Incluida_en_Actas:44=True:C214;*)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas:18]Incide_en_promedio:27=True:C214;*)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas:18]Es_Optativa:70=False:C215;*)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas:18]Asignatura:3#"Religión";*)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Alumnos_Calificaciones:208]EvaluacionFinalOficial_Literal:36#"")
	ORDER BY:C49([Alumnos_Calificaciones:208];[Asignaturas:18]Asignatura:3;>)
	SELECTION TO ARRAY:C260([Alumnos_Calificaciones:208]EvaluacionFinalOficial_Literal:36;$aGrades;[Asignaturas:18]Asignatura:3;$aAsig;[Asignaturas:18]posicion_en_informes_de_notas:36;$aOrden;[Asignaturas:18]ordenGeneral:105;$atOrdenGeneral)
	SET AUTOMATIC RELATIONS:C310(False:C215;False:C215)
	
	For ($i;Size of array:C274($aAsig);1;-1)
		If ($aAsig{$i}=$aAsig{$i-1})
			AT_Delete ($i;1;->$aGrades;->$aAsig;->$aOrden)
		End if 
	End for 
	AT_MultiLevelSort (">>";->$aOrden;->$aAsig;->$aGrades)
	For ($i;1;Size of array:C274($aAsig))
		APPEND TO ARRAY:C911($aAsignaturas_Alumno_PC;$aAsig{$i})
	End for 
	
End if 





  //ASIGNATURAS PLAN ELECTIVO
GOTO RECORD:C242([Alumnos:2];$recNum)
SET AUTOMATIC RELATIONS:C310(True:C214;False:C215)
QUERY:C277([Alumnos_Calificaciones:208];[Alumnos_Calificaciones:208]ID_Alumno:6;=;[Alumnos:2]numero:1;*)
QUERY:C277([Alumnos_Calificaciones:208]; | [Alumnos_Calificaciones:208]ID_Alumno:6;=;-[Alumnos:2]numero:1)
QRY_QueryWithArray (->[Alumnos_Calificaciones:208]Año:3;->$aAños;True:C214)
QUERY SELECTION:C341([Alumnos_Calificaciones:208];[Asignaturas_Historico:84]Electiva:10=True:C214;*)
QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas_Historico:84]Incluida_En_Actas:7=True:C214;*)
QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas_Historico:84]Promediable:6=True:C214;*)
QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas_Historico:84]Optativa:24=False:C215;*)
QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas_Historico:84]Asignatura:2#"Religión";*)
QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Alumnos_Calificaciones:208]EvaluacionFinalOficial_Literal:36#"")
ORDER BY:C49([Alumnos_Calificaciones:208];[Asignaturas_Historico:84]Asignatura:2;>)
SELECTION TO ARRAY:C260([Alumnos_Calificaciones:208]EvaluacionFinalOficial_Literal:36;$aGrades;[Asignaturas_Historico:84]Asignatura:2;$aAsig;[Asignaturas_Historico:84]Order:11;$aOrden;[Asignaturas_Historico:84]OrdenGeneral:42;$atOrdenGeneral)
SET AUTOMATIC RELATIONS:C310(False:C215;False:C215)
For ($i;Size of array:C274($aAsig);1;-1)
	If ($aAsig{$i}=$aAsig{$i-1})
		AT_Delete ($i;1;->$aGrades;->$aAsig;->$aOrden)
	End if 
End for 
AT_MultiLevelSort (">>";->$aOrden;->$aAsig;->$aGrades)
For ($i;1;Size of array:C274($aAsig))
	APPEND TO ARRAY:C911($aAsignaturas_Alumno_PE;$aAsig{$i})
End for 


GOTO RECORD:C242([Alumnos:2];$recNum)
If ([Alumnos:2]nivel_numero:29<=12)
	SET AUTOMATIC RELATIONS:C310(True:C214;False:C215)
	EV2_RegistrosDelAlumno ([Alumnos:2]numero:1)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208];[Asignaturas:18]Electiva:11=True:C214;*)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas:18]Incluida_en_Actas:44=True:C214;*)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas:18]Incide_en_promedio:27=True:C214;*)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas:18]Es_Optativa:70=False:C215;*)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Asignaturas:18]Asignatura:3#"Religión";*)
	QUERY SELECTION:C341([Alumnos_Calificaciones:208]; & [Alumnos_Calificaciones:208]EvaluacionFinalOficial_Literal:36#"")
	ORDER BY:C49([Alumnos_Calificaciones:208];[Asignaturas:18]Asignatura:3;>)
	SELECTION TO ARRAY:C260([Alumnos_Calificaciones:208]EvaluacionFinalOficial_Literal:36;$aGrades;[Asignaturas:18]Asignatura:3;$aAsig;[Asignaturas:18]posicion_en_informes_de_notas:36;$aOrden;[Asignaturas:18]ordenGeneral:105;$atOrdenGeneral)
	SET AUTOMATIC RELATIONS:C310(False:C215;False:C215)
	
	For ($i;Size of array:C274($aAsig);1;-1)
		If ($aAsig{$i}=$aAsig{$i-1})
			AT_Delete ($i;1;->$aGrades;->$aAsig;->$aOrden)
		End if 
	End for 
	AT_MultiLevelSort (">>";->$aOrden;->$aAsig;->$aGrades)
	For ($i;1;Size of array:C274($aAsig))
		APPEND TO ARRAY:C911($aAsignaturas_Alumno_PE;$aAsig{$i})
	End for 
	
End if 

GOTO RECORD:C242([Alumnos:2];$recNum)
If ([Alumnos:2]nivel_numero:29<=12)
	$año:=<>gYear
Else 
	QUERY:C277([Alumnos_SintesisAnual:210];[Alumnos_SintesisAnual:210]ID_Alumno:4;=;-[Alumnos:2]numero:1;*)
	QUERY:C277([Alumnos_SintesisAnual:210]; & [Alumnos_SintesisAnual:210]NumeroNivel:6;=;12;*)
	QUERY:C277([Alumnos_SintesisAnual:210]; & [Alumnos_SintesisAnual:210]SituacionFinal:8;=;"P")
	$año:=[Alumnos_SintesisAnual:210]Año:2
End if 



$namePref:="ConcentraciónNotas.cl."+String:C10($año)
$blob:=PREF_fGetBlob (0;$namePref;$blob)
BLOB_Blob2Vars (->$blob;0;->aPCAsgName;->aPCAsgPos;->aPEAsgName;->aPEAsgPos)



For ($i;Size of array:C274(aPCAsgName);1;-1)
	If ((Find in array:C230($aAsignaturas_Alumno_PC;aPCAsgName{$i})<0) & (Find in array:C230($aAsignaturas_Alumno_PE;aPCAsgName{$i})<0))
		AT_Delete ($i;1;->aPCAsgName;->aPCAsgPos)
	End if 
End for 

For ($i;Size of array:C274(aPEAsgName);1;-1)
	If ((Find in array:C230($aAsignaturas_Alumno_PC;aPEAsgName{$i})<0) & (Find in array:C230($aAsignaturas_Alumno_PE;aPEAsgName{$i})<0))
		AT_Delete ($i;1;->aPEAsgName;->aPEAsgPos)
	End if 
End for 


If (vl_OrdenAlfabetico=1)
	AT_MultiLevelSort (">>";->aPCAsgName;->aPCAsgPos)
End if 

For ($i;1;Size of array:C274(aPCAsgName))
	If ($i<=20)
		$ptr:=Get pointer:C304("vAsigPC_"+String:C10($i))
		$ptr->:=aPCAsgName{$i}
	End if 
End for 

Case of 
	: (tipoDocumento="Carta")
		$cantidadElectivas:=12
	: (tipoDocumento="Oficio")
		$cantidadElectivas:=24
End case 

If (vl_OrdenAlfabetico=1)
	AT_MultiLevelSort (">>";->aPEAsgName;->aPEAsgPos)
End if 
For ($i;1;Size of array:C274(aPEAsgName))
	If ($i<=$cantidadElectivas)
		$ptr:=Get pointer:C304("vAsigPE_"+String:C10($i))
		$ptr->:=aPEAsgName{$i}
	End if 
End for 

GOTO RECORD:C242([Alumnos:2];$recNum)